#!/bin/bash
#---------------------------------------------------------------------------
#|       o        |
#|    o     o     |  HELYX (R) : Open-source CFD for Enterprise
#|   o   O   o    |  Version : 4.4.0
#|    o     o     |  ENGYS Ltd. <http://engys.com/>
#|       o        |
#---------------------------------------------------------------------------
#License
#    This file is part of HELYXcore.
#    HELYXcore is based on OpenFOAM (R) <http://www.openfoam.org/>.
#
#    HELYXcore is free software: you can redistribute it and/or modify it
#    under the terms of the GNU General Public License as published by
#    the Free Software Foundation, either version 3 of the License, or
#    (at your option) any later version.
#
#    HELYXcore is distributed in the hope that it will be useful, but WITHOUT
#    ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
#    FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
#    for more details.
#
#    You should have received a copy of the GNU General Public License
#    along with HELYXcore.  If not, see <http://www.gnu.org/licenses/>.
#
# Copyright
#    (c) 2023-2025 Engys Ltd.
#
# Script
#    helyxClean
#
# Description
#    Cleans an example case directory
#
#------------------------------------------------------------------------------

usage() {
    exec 1>&2
    while [ "$#" -ge 1 ]; do echo "$1"; shift; done
    cat<<USAGE

Usage: ${0##*/} [OPTION] ...
options:
  -keepMesh         do not clean reconstructed mesh directory
  -case <dir>       specify alternative case directory, default is the cwd
  -help             print the usage

* Clean up files that are typically generated in a case directory.
* If system/caseSetupDict is present, additionally performs a more aggressive
  cleanup of files that are typically generated by the caseSetup utility.

USAGE
    exit 1
}

keepMeshOpt=false
# Parse options
while [ "$#" -gt 0 ]
do
   case "$1" in
   -keepMesh)
      keepMeshOpt=true
      shift
      ;;
   -h | -help)
      usage
      ;;
   -case)
      [ "$#" -ge 2 ] || usage "'$1' option requires an argument"
      cd "$2" 2>/dev/null || usage "directory does not exist:  '$2'"
      shift 2
      ;;
   --)
      shift
      break
      ;;
   -*)
      usage "invalid option '$1'"
      ;;
   *)
      break
      ;;
   esac
done

# Source tutorial clean functions
. $HELYX_PROJECT_DIR/bin/tools/CleanFunctions

if [ "$keepMeshOpt" = true ]
then
   cleanTimeDirectories
   rm -rf postProcessing > /dev/null 2>&1
else
   cleanCase
fi

if [ -f system/caseSetupDict ]
then
    # Remove typical caseSetup-generated files in all regions
    rm -f \
    constant/dynamicMeshDict \
    constant/regionProperties \
    constant/turbulenceProperties constant/*/turbulenceProperties \
    constant/turbulenceProperties.* constant/*/turbulenceProperties.* \
    constant/radiationProperties constant/*/radiationProperties \
    constant/boundaryRadiationProperties constant/*/boundaryRadiationProperties \
    constant/g constant/*/g \
    system/fv* system/*/fv* \
    system/fa* system/*/fa* \
    system/meshObjects system/*/meshObjects \
    system/materialProperties system/*/materialProperties \
    system/nonConformalCouplesDict system/*/nonConformalCouplesDict > /dev/null 2>&1

    rm -rf 0 > /dev/null 2>&1
    rmdir constant/* > /dev/null 2>&1
    rmdir constant > /dev/null 2>&1
    rmdir system/* > /dev/null 2>&1
fi

#------------------------------------------------------------------------------
