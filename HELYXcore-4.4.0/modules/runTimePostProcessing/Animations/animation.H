/*---------------------------------------------------------------------------*\
|       o        |
|    o     o     |  HELYX (R) : Open-source CFD for Enterprise
|   o   O   o    |  Version : 4.4.0
|    o     o     |  ENGYS Ltd. <http://engys.com/>
|       o        |
\*---------------------------------------------------------------------------
License
    This file is part of HELYXcore.
    HELYXcore is based on OpenFOAM (R) <http://www.openfoam.org/>.

    HELYXcore is free software: you can redistribute it and/or modify it
    under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    HELYXcore is distributed in the hope that it will be useful, but WITHOUT
    ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
    FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
    for more details.

    You should have received a copy of the GNU General Public License
    along with HELYXcore.  If not, see <http://www.gnu.org/licenses/>.

Copyright
    (c) 2015-2019 OpenCFD Ltd.
    (c) 2020-2025 Engys Ltd.

Class
    Foam::functionObjects::runTimeVis::Animation

Group
    grpGraphicsFunctionObjects

Description
    Generate an animation based on the images generated by RunTimeVisulisation/RTPP

    The functionality makes use of the VTK libraries (see http://www.vtk.org)
    which provide a broad set of functionality for scene composition and
    manipulation.

    The animations are generated based on source items that are described in
    the controlDict file generated by the Helyx GUI.

SourceFiles
    Animation.C

\*---------------------------------------------------------------------------*/

#pragma once

#include <memory>

#include "rtppFunctionObject.H"

#include "animationData.H"

#include "postDictObjectProviderDatabase.H"

// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

// Forward declarations
class engysAnimationFilter;

namespace Foam::functionObjects
{

/*---------------------------------------------------------------------------*\
                   Class Animation Declaration
\*---------------------------------------------------------------------------*/

class Animation : public rtppFunctionObject
{

private:

    // Private member variables
    animations::AnimationData data_;
    vtkSmartPointer<engysAnimationFilter> animationFilter;
    fileName postProcessingFolder_;
    fileName name_;
    fileName animationFilePath_;

    // Private Member Functions

    void beforeWriting();
    void writeData();
    void afterWriting();

    void addRTPPImageFolder(const word& rtppName, double timeOffset) const;
    void addRTPPSceneImageFolder(const word& rtppName, const std::string& sceneName, const fileName& sceneFolder, double timeOffset) const;

    static void turnFloatingPointExceptionsOff();
    static void turnFloatingPointExceptionsOn();

public:

    //- Runtime type information
    TypeName("Animation");

    // Constructors

    //- Construct from dictionary
    Animation
        (
            const word &name,
            const Time &runTime,
            const dictionary &dict
        );


    //- Destructor
    ~Animation() override = default;

    // Member Functions

    //- Execute, currently does nothing
    bool execute() override
    { return true; }

    bool write() override;
};


// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

} // End namespace functionObjects
// End namespace Foam

// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

// ************************************************************************* //
