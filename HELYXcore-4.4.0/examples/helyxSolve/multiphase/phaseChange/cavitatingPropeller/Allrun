#!/bin/bash
cd "${0%/*}" || exit 1    # Run from this directory
set -e                    # Exit immediately if a command fails

#------------------------------------------------------------------------------

# Copy propeller surface from resources directory
mkdir -p constant/triSurface
cp "$HELYX_TUTORIALS"/resources/geometry/propeller/* constant/triSurface/
cp "$HELYX_TUTORIALS"/resources/geometry/propellerTip.obj.gz constant/triSurface/

# Generate mesh
helyxRun -p helyxHexMesh -overwrite

# Generate face/cell sets and zones
helyxRun topoSet -dict system/createInletOutletSets.topoSetDict

# Create the inlet/outlet and AMI patches
helyxRun createPatch -overwrite

# Test by running moveDynamicMesh
#helyxRun moveDynamicMesh -checkAMI

# Set up case
helyxRun caseSetup

# Run solver specified in controlDict
helyxRun

# Reconstruct
helyxRun reconstructParMesh -constant -mergeTol 1e-6
helyxRun reconstructPar

# Create dummy file for ParaView visualisation
touch cavitatingPropeller.foam

#------------------------------------------------------------------------------
