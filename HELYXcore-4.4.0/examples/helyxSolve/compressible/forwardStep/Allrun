#!/bin/bash
cd "${0%/*}" || exit 1    # Run from this directory
set -e                    # Exit immediately if a command fails

#------------------------------------------------------------------------------

# Create mesh
helyxRun blockMesh

# Refine mesh by cell set 1
echo "Creating cell set for primary zone 1"
helyxRun -log log.topoSet.1 topoSet -dict system/topoSetDict.1
echo "Refining primary zone 1"
helyxRun -log log.refineMesh.1 refineMesh -overwrite

# Refine mesh by cell set 2
echo "Creating cell set for primary zone 2"
helyxRun -log log.topoSet.2 topoSet -dict system/topoSetDict.2
echo "Refining primary zone 2"
helyxRun -log log.refineMesh.2 refineMesh -overwrite

# Decompose
helyxRun decomposePar

# Setup
helyxRun caseSetup

# Run
helyxRun helyxSolve

# Create dummy file for ParaView visualisation
touch forwardStep.foam

#------------------------------------------------------------------------------
