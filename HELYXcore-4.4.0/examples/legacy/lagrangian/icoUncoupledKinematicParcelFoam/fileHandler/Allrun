#!/bin/bash
cd "${0%/*}" || exit 1    # Run from this directory
set -e                    # Exit immediately if a command fails

#------------------------------------------------------------------------------

helyxRun blockMesh

# Test writing collated format
helyxRun decomposePar -fileHandler collated
helyxRun -np 4 icoUncoupledKinematicParcelFoam -fileHandler collated
helyxRun reconstructPar -latestTime -fileHandler collated

# Delete collated files
rm -rf processors*

# Test writing uncollated format
helyxRun -l log.decomposePar.uncollated decomposePar -fileHandler uncollated
helyxRun -l log.icoUncoupledKinematicParcelFoam.uncollated icoUncoupledKinematicParcelFoam -fileHandler uncollated

# Restart from uncollated
helyxRun -p -l log.icoUncoupledKinematicParcelFoam.collated icoUncoupledKinematicParcelFoam -fileHandler collated
helyxRun -l log.reconstructPar.collated reconstructPar -latestTime -fileHandler collated

# Convert the parallel format to uncollated
helyxRun -np 4 foamFormatConvert -fileHandler uncollated

# Create dummy file for ParaView visualisation
touch fileHandler.foam

#------------------------------------------------------------------------------
